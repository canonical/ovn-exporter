#!/bin/bash
set -e

# Set OVS and OVN run directories when ovn-chassis interface is connected
# Note: ovn-chassis now provides both switch and ovn runtime directories
snapctl set "apps.ovn-exporter.env.ovs-rundir"="$SNAP_COMMON/run/switch"
snapctl set "apps.ovn-exporter.env.ovs-vswitchd-pid"="$SNAP_COMMON/run/switch/ovs-vswitchd.pid"
snapctl set "apps.ovn-exporter.env.ovsdb-server-pid"="$SNAP_COMMON/run/switch/ovsdb-server.pid"
snapctl set "apps.ovn-exporter.env.ovn-rundir"="$SNAP_COMMON/run/ovn"
echo "Set OVS_RUNDIR to $SNAP_COMMON/run/switch and OVN_RUNDIR to $SNAP_COMMON/run/ovn"

# Restart the service to pick up new environment (ignore errors)
snapctl restart ovn-exporter.ovn-exporter || echo "Service restart failed, continuing..."