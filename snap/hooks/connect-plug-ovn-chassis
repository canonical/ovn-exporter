#!/bin/bash
set -e

# Set OVS and OVN run directories when ovn-chassis interface is connected
# Note: ovn-chassis now provides both switch and ovn runtime directories
snapctl set "ovs-rundir"="$SNAP_COMMON/run/switch/"
snapctl set "ovn-rundir"="$SNAP_COMMON/run/ovn/"
echo "Set OVS_RUNDIR to $SNAP_COMMON/run/switch/ and OVN_RUNDIR to $SNAP_COMMON/run/ovn/"

# Explicit restart to ensure service picks up configuration
# This is queued and will execute after this hook and the configure hook complete
snapctl restart ovn-exporter.ovn-exporter 2>/dev/null || echo "Service restart scheduled"
