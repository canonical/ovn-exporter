#!/bin/bash

set -e

# Configuration hook for ovn-exporter snap
# This hook validates configuration options and restarts the service when needed

# List of supported configuration options
config_options=(
	"ovn-rundir"
	"ovs-rundir"
	"ovs-vswitchd-pid"
	"ovsdb-server-pid"
	"ovn-nbdb-location"
	"ovn-sbdb-location"
)

# Flag to track if any configuration changed
config_changed=false

# Validate and set default values if needed
for option in "${config_options[@]}"; do
	# Get current value
	current_value=$(snapctl get "$option" 2>/dev/null || echo "")

	if [[ -n $current_value ]]; then
		config_changed=true
		break
	fi
done

# Restart service if any configuration changed
if [[ $config_changed == "true" ]]; then
	echo "Configuration changes detected, restarting ovn-exporter service"
	snapctl restart ovn-exporter.ovn-exporter 2>/dev/null || echo "Service restart scheduled"
else
	echo "No configuration changes detected"
fi
