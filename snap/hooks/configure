#!/bin/bash
set -e

# Configuration hook for ovn-exporter snap
# Validates configuration options without restarting the service
# Note: Service restarts are handled by connect-plug hooks to avoid
# hitting systemd rate limits when multiple interfaces connect

# Supported configuration options
declare -a CONFIG_KEYS=(
	"ovn-rundir"
	"ovs-rundir"
	"ovn-nbdb-location"
	"ovn-sbdb-location"
)

# Check if any configuration is set
has_config=false
for key in "${CONFIG_KEYS[@]}"; do
	if value=$(snapctl get "$key" 2>/dev/null) && [[ -n $value ]]; then
		has_config=true
		echo "Config set: $key=$value"
	fi
done

# Report configuration status
if [[ $has_config == "true" ]]; then
	echo "Configuration validated successfully"
	echo "Note: Manual config changes require: snap restart ovn-exporter"
else
	echo "No configuration set (using defaults)"
fi
